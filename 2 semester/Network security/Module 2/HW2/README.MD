# Модуль 2. Сканирование сетей (HW)

## Лабораторная работа №2 (HW)
Для выполнения данной лабораторной работы пришлось устанавливать Windows на виртуальную машину

### Шаг 1. Установите Nmap на Linux  (на Kali nmap уже предустановлен)
![alt text](image-1.png)

### Шаг 2. Установите Nmap на Windows

![alt text](image-17.png)

### Шаг 3. Узнайте IP-адрес на двух машинах

IP-адрес машины Windows - **192.168.1.103**
![alt text](image-18.png)

IP-адрес машины Kali Linux - **192.168.1.113**
![alt text](image-4.png)

### Шаг 4. Исследуем доступность сети

### С машины Windows

**TCP SYN Ping**
![alt text](image-19.png)

**TCP ACK Ping**
![alt text](image-20.png)

**UDP Ping**
![alt text](image-21.png)

**ICMP Ping Types**
![alt text](image-22.png)

**IP Protocol Ping**
![alt text](image-23.png)

**Обычный ping-скан**
![alt text](image-24.png)

### С машины Kali Linux

**TCP SYN Ping**

![alt text](image-25.png)

**TCP ACK Ping**

![alt text](image-26.png)

**UDP Ping**

![alt text](image-27.png)

**ICMP Ping Types**

![alt text](image-28.png)

**IP Protocol Ping**

![alt text](image-29.png)

**Обычный ping-скан**

![alt text](image-30.png)

**Таблица сравнения результатов**

| Вид сканирования     | Описание | Найденные хосты (пример) | Оценка скорости работы |
|----------------------|-----------------------------------------------|-------------------------|------------------------|
| **TCP SYN Ping**     | Отправляет SYN на порт (обычно 80), ждет SYN/ACK | Определяет хосты с открытым портом 80 | Средняя скорость, зависит от количества открытых портов |
| **TCP ACK Ping**     | Отправляет ACK, ждет RST | Полезно для обхода фильтров, определяет активные хосты за брандмауэрами | Средняя, но может быть быстрее, чем SYN Ping, в некоторых случаях |
| **UDP Ping**         | Отправляет UDP-пакет (обычно 53), ждет ICMP Port Unreachable | Хорошо работает, если ICMP не фильтруется | Медленнее, чем TCP, из-за необходимости ожидания ICMP |
| **ICMP Ping Types**  | Использует ICMP Echo Request (-PE), Timestamp Request (-PP), Address Mask Request (-PM) | Выявляет большинство активных хостов | Быстрое выполнение, так как работает с базовыми ICMP-запросами |
| **IP Protocol Ping** | Использует нестандартные IP-протоколы (GRE, ESP, AH) | Полезно против фильтрации ICMP и TCP | Медленное выполнение, так как использует нестандартные протоколы |
| **Обычный -sn**      | Минимальное обнаружение хостов без сканирования портов | Зависит от политики сети | Очень быстрое, так как не включает портовое сканирование |

### Шаг 5. Просканируйте каждую машину с другой с помощью команды

**Сканирование с Windows**

![alt text](image-54.png)

Видим, что на хосте Kali открыт 21-ый порт, порт управляющего соединения FTP, который был открыт в рамках предудыщей ЛР

**Сканирование с Kali Linux**

На Windows-хосте, согласно сканирования с Kali-хоста, открытые порты отсутствуют

![alt text](image-52.png)

Хотя если Windows-хост будет сканировать сам себя, то результат покажет наличие открытых tcp-портов:
![alt text](image-53.png)

### Шаг 6. Выберите какой-нибудь порт, полученный в пункте 4 (видимо речь про п.5, так что берем 21-ый), и просканируйте его с помощью методов TCP SYN Scan, TCP Connect Scan, UDP Scan, TCP FIN Scan, TCP NULL Scan, TCP Xmas Scan и TCP ACK Scan. Сделайте скриншот каждого результата.

#### TCP SYN Scan
![alt text](image-56.png)
Порт открыт

#### TCP Connect Scan
![alt text](image-57.png)
Порт открыт

#### UDP Scan
![alt text](image-58.png)
Порт закрыт. Видимо, потому что это не UDP порт

#### TCP FIN Scan
![alt text](image-59.png)
Порт открыт и не отвечает на нестандартные TCP-пакеты.

#### TCP NULL Scan
![alt text](image-60.png)
Порт открыт и не отвечает на нестандартные TCP-пакеты.

#### TCP Xmas Scan
![alt text](image-61.png)
Порт открыт и не отвечает на нестандартные TCP-пакеты.

#### TCP ACK Scan
![alt text](image-62.png)
ACK-пакеты не могут определить, открыт ли порт. Они только говорят, что он не фильтруется.

### Шаг 7. На машину с Ubuntu установите веб-сервер Apache2
![alt text](image-49.png)

### Шаг 8. Настройка и запуск веб-сервера Apache2

**Прописываем слушать 5000 порт в конфиге**

![alt text](image-91.png)

<!-- ![alt text](image-48.png) -->

**Перезапускаем сервер для того, чтобы подхватился конфиг**

![alt text](image-50.png)

### Шаг 9. С Windows повторите команду из пункта 4 (видимо речь про п.5). Появился ли ранее указанный порт?

После того, как на Kali был поднят Apache веб-сервер, видим что 5000-ый порт появился в результатах сканирования...
![alt text](image-92.png)

**Просканируйте диапазон, в который входит порт, указанный в пункте 7 (тут путаница с пунктами, они не соответвуют пункам из задания, поэтому остается только догадываться, что имелось ввиду, видимо речь снова про 5000-ый порт)**

Сканируем дианазон портов 5000-5100
![alt text](image-93.png)
В общем-то, результат довольно очевидный - видим открытый 5000-ый порт

**Проверьте на этом порту методы сканирования из пункта 5 (видимо речь про п. 6).**

#### TCP SYN Scan
![alt text](image-94.png)

#### TCP Connect Scan
![alt text](image-95.png)

#### UDP Scan
![alt text](image-96.png)

#### TCP FIN Scan
![alt text](image-97.png)

#### TCP NULL Scan
![alt text](image-98.png)

#### TCP Xmas Scan
![alt text](image-99.png)

#### TCP ACK Scan
![alt text](image-100.png)


### Шаг 10. Просканируйте машину Linux с помощью команды nmap -sV <ip-адрес>. Опишите полученные результаты

Опция -sV включает определение версий сервисов, работающих на открытых портах.

![alt text](image-101.png)

В результате сканирования мы видим не только открытые порты, но и версии сервисов, запущенных на них.
Видим, что на 21-ом порту запущен ftp-сервис vsftpd v.3.0.5, а на 5000-ом порту - веб-сервер Apache 2.4.63 Debian версия

### Шаг 11. Установите Postgresql на Linux командой sudo apt install postgresql

![alt text](image-73.png)

Проверяем наличие psql (Postgresql предустановлена на Kali)

![alt text](image-74.png)

Запускаем сервис postgresql

### Шаг 12. Повторите пункт 9. Напишите, что изменилось.

![alt text](image-75.png)

Результат сканирования не изменился. Видимо в задании предполагалось, что после запуска сервиса pgsql должен появиться порт pg, однако это требует дополнительной настройки сервиса, т.к. по умолчанию pg слушает только localhost.

### Шаг 13. Просканируйте нестандартный порт из 7 и порт Postgresql, указывая уровни интенсивности от 1 до 9. Сравните полученные результаты и опишите, какие результаты соответствуют действительности.

\* Из-за того, что postgresql на настроен и его порт не виден результаты отражены для порта 5000

**Интенсивность 1**

![alt text](image-102.png)

**Интенсивность 2**
![alt text](image-103.png)

**Интенсивность 3**
![alt text](image-104.png)

**Интенсивность 4**
![alt text](image-105.png)

**Интенсивность 5**
![alt text](image-106.png)

**Интенсивность 6**
![alt text](image-107.png)

**Интенсивность 7**
![alt text](image-108.png)

**Интенсивность 8**
![alt text](image-109.png)

**Интенсивность 9**
![alt text](image-110.png)

**Сканирование с другим флагом (T) с максимальным уровнем интенсивности insanе (T5)**
![alt text](image-111.png)

В результате пробовал использовать все уровни интенсивности от 1 до 9 - результат одинаковый

### Шаг 14. Заблокируйте любой порт из открытых на машине Linux с помощью iptables по политике REJECT.

Блокируем 5000-ый порт
![alt text](image-112.png)

### Шаг 15. Просканируйте заблокированный в пункте 13 (14) порт типами сканирования TCP SYN Scan, TCP Connect Scan, UDP Scan, TCP FIN Scan, TCP NULL Scan, TCP Xmas Scan и TCP ACK Scan. Сравните полученные результаты.

#### TCP SYN Scan
![alt text](image-120.png)
REJECT отправляет ответ RST, nmap считает порт закрытым.

#### TCP Connect Scan
![alt text](image-114.png)
Порт показывается как filtered

#### UDP Scan
![alt text](image-115.png)
Порт показывается как closed

#### TCP FIN Scan
![alt text](image-121.png)
Порт показывается как closed

#### TCP NULL Scan
![alt text](image-122.png)
Порт показывается как closed

#### TCP Xmas Scan
![alt text](image-123.png)
Порт показывается как closed

#### TCP ACK Scan
![alt text](image-124.png)
Порт показывается как unfiltered


### Шаг 16. Удалите правило из пункта 13 (14) и добавьте аналогичное, но с политикой DROP. Повторите пункт 14 (15). Сравните результаты с пунктом 14 (15).

#### TCP SYN Scan
![alt text](image-125.png)
Порт показывается как filtered

#### TCP Connect Scan
![alt text](image-126.png)
Порт показывается как filtered

#### UDP Scan
![alt text](image-127.png)
Порт показывается как closed

#### TCP FIN Scan
![alt text](image-128.png)

Порт показывается как open|filtered

#### TCP NULL Scan
![alt text](image-129.png)
Порт показывается как open|filtered

#### TCP Xmas Scan
![alt text](image-130.png)
Порт показывается как open|filtered

#### TCP ACK Scan
![alt text](image-131.png)
Порт показывается как filtered

