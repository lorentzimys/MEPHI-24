# Практическое задание №1
## Математическая модель оптимизации доставки для интернет-магазина

---

## 1. Контекст задачи

### 1.1. Определение проблемы

Интернет-магазин бытовой техники и электроники сталкивается с проблемой неоптимальной организации доставки товаров клиентам. Основные проблемы:

- **Высокие затраты на доставку** из-за неэффективного распределения заказов между складами
- **Длительное время доставки** для клиентов, находящихся далеко от складов
- **Неравномерная загрузка складов** — некоторые склады перегружены, другие недогружены
- **Отсутствие единой стратегии** выбора склада для выполнения заказа

### 1.2. Среда и ограничения

**Физические ограничения:**
- Склады расположены в фиксированных городах (например, Москва, Санкт-Петербург, Екатеринбург, Новосибирск)
- Каждый склад имеет ограниченную вместимость и пропускную способность
- Товары имеют различные габариты и вес, что влияет на стоимость доставки
- Доступны различные способы доставки: курьерская служба, транспортные компании, почта

**Экономические ограничения:**
- Бюджет на доставку ограничен
- Стоимость доставки зависит от расстояния, веса и габаритов товара
- Необходимо учитывать стоимость хранения товаров на складах

**Временные ограничения:**
- Клиенты ожидают доставку в определенные сроки (обычно 1-7 дней)
- Время обработки заказа на складе ограничено рабочими часами
- Необходимо учитывать время в пути для различных способов доставки

**Технические ограничения:**
- Не все склады имеют все товары в наличии
- Требуется учет логистических возможностей каждого склада

### 1.3. Цели и критерии успеха

**Количественные показатели:**
- Снижение средних затрат на доставку на 20% в течение 6 месяцев
- Сокращение среднего времени доставки до 3 дней для 90% заказов
- Оптимизация загрузки складов: коэффициент использования каждого склада должен быть в диапазоне 70-90%

**Качественные показатели:**
- Повышение уровня удовлетворенности клиентов (NPS > 50)
- Улучшение прозрачности процесса доставки для клиентов
- Создание масштабируемой системы, способной обрабатывать рост заказов

---

## 2. Сбор данных

### 2.1. Определение источников данных

**Внутренние источники:**
- База данных заказов за последние 12 месяцев
- Информация о складах: местоположение, вместимость, текущие запасы
- История доставок: время доставки, стоимость, способ доставки
- Данные о клиентах: адреса доставки, частота заказов

**Внешние источники:**
- Тарифы транспортных компаний и курьерских служб
- Данные о расстояниях между городами (можно использовать API картографических сервисов)
- Статистика по средним срокам доставки в различных регионах

**Экспериментальные данные:**
- Результаты A/B тестирования различных стратегий распределения заказов
- Данные о влиянии сезонности на спрос и доставку

### 2.2. Подготовка данных для анализа

**Структура данных:**

**Таблица складов:**
- `W_i` — идентификатор склада (i = 1, 2, ..., m)
- `L_i` — местоположение склада (координаты или город)
- `C_i` — вместимость склада (объем в м³)
- `Q_i` — текущий объем товаров на складе
- `K_i` — пропускная способность (заказов в день)

**Таблица заказов:**
- `O_j` — идентификатор заказа (j = 1, 2, ..., n)
- `D_j` — адрес доставки клиента
- `V_j` — объем товара в заказе (м³)
- `W_j` — вес заказа (кг)
- `T_j` — желаемый срок доставки (дни)
- `P_j` — приоритет заказа (обычный/срочный)

**Таблица доставок:**
- Расстояние от склада i до адреса доставки j: `d_{ij}` (км)
- Стоимость доставки: `c_{ij}` (руб.)
- Время доставки: `t_{ij}` (дни)
- Способ доставки: `s_{ij}` (курьер/транспортная компания/почта)

**Обработка данных:**
- Устранение пропущенных значений (заполнение средними значениями или исключение записей)
- Удаление дубликатов заказов
- Нормализация адресов для точного расчета расстояний
- Приведение единиц измерения к единому формату

### 2.3. Оценка качества данных

**Проверки:**
- Валидация координат складов и адресов доставки
- Проверка на выбросы в стоимости и времени доставки
- Анализ корректности данных о весе и объеме товаров
- Проверка логической согласованности (например, время доставки не может быть отрицательным)

**Пример данных (упрощенный):**

| Склад | Город | Вместимость (м³) | Текущий объем (м³) | Пропускная способность (заказов/день) |
|-------|-------|------------------|-------------------|--------------------------------------|
| W₁    | Москва | 5000            | 3200              | 150                                  |
| W₂    | СПб    | 4000            | 2500              | 120                                  |
| W₃    | Екатеринбург | 3000        | 1800              | 100                                  |
| W₄    | Новосибирск | 3500         | 2100              | 110                                  |

---

## 3. Анализ требований

### 3.1. Сбор требований

**Функциональные требования:**

1. **Требование распределения заказов:**
   - Каждый заказ должен быть назначен ровно одному складу
   - Склад должен иметь достаточный запас товара для выполнения заказа
   - Назначение должно учитывать текущую загрузку склада

2. **Требование минимизации затрат:**
   - Общая стоимость доставки всех заказов должна быть минимальной
   - Необходимо учитывать стоимость хранения товаров на складах
   - Учитывать скидки при больших объемах доставки

3. **Требование времени доставки:**
   - Время доставки не должно превышать желаемый срок клиента
   - Приоритетные (срочные) заказы должны обрабатываться в первую очередь
   - Среднее время доставки должно быть минимизировано

4. **Требование загрузки складов:**
   - Загрузка каждого склада не должна превышать его пропускную способность
   - Необходимо равномерно распределять нагрузку между складами

**Нефункциональные требования:**

1. **Производительность:**
   - Модель должна обрабатывать до 1000 заказов в день
   - Время расчета оптимального распределения не должно превышать 5 минут

2. **Масштабируемость:**
   - Модель должна легко адаптироваться при добавлении новых складов
   - Должна учитывать возможность изменения параметров складов

3. **Надежность:**
   - Модель должна работать даже при отсутствии некоторых данных (использовать оценки)
   - Должна предусматривать резервные варианты доставки

### 3.2. Документирование требований

**Приоритизация требований:**

**Высокий приоритет:**
- Минимизация общей стоимости доставки
- Соблюдение сроков доставки для клиентов
- Ограничение пропускной способности складов

**Средний приоритет:**
- Равномерное распределение нагрузки между складами
- Учет приоритетов заказов
- Оптимизация использования складских площадей

**Низкий приоритет:**
- Учет сезонных колебаний спроса
- Интеграция с системами прогнозирования спроса

### 3.3. Дополнительные факторы

**Сезонность:**
- В предпраздничные периоды спрос увеличивается, что влияет на загрузку складов
- В летний период доставка в некоторые регионы может быть затруднена

**Акции и маркетинговые кампании:**
- Проведение акций может резко увеличить количество заказов
- Необходимо учитывать возможность временного увеличения пропускной способности

**Региональные особенности:**
- В некоторых регионах доступны не все способы доставки
- Стоимость доставки может варьироваться в зависимости от региона

---

## 4. Формализация задачи

### 4.1. Определение переменных и параметров

**Индексы:**
- `i = 1, 2, ..., m` — индексы складов
- `j = 1, 2, ..., n` — индексы заказов

**Параметры модели:**

- `d_{ij}` — расстояние от склада i до адреса доставки заказа j (км)
- `c_{ij}` — стоимость доставки заказа j со склада i (руб.)
- `t_{ij}` — время доставки заказа j со склада i (дни)
- `V_j` — объем заказа j (м³)
- `W_j` — вес заказа j (кг)
- `T_j` — желаемый срок доставки заказа j (дни)
- `P_j` — приоритет заказа j (1 — срочный, 0 — обычный)
- `C_i` — вместимость склада i (м³)
- `Q_i` — текущий объем товаров на складе i (м³)
- `K_i` — пропускная способность склада i (заказов в день)
- `A_i` — текущее количество заказов на складе i
- `α` — коэффициент штрафа за нарушение срока доставки
- `β` — коэффициент штрафа за превышение пропускной способности

**Переменные решения:**

- `x_{ij} = 1`, если заказ j назначается складу i, и `x_{ij} = 0` в противном случае
- Это бинарные переменные, определяющие распределение заказов по складам

### 4.2. Построение математической модели

**Целевая функция:**

Минимизировать общую стоимость доставки с учетом штрафов за нарушение сроков и перегрузку складов:

```
min Z = Σᵢ Σⱼ c_{ij} · x_{ij} + 
        α · Σᵢ Σⱼ max(0, t_{ij} - T_j) · P_j · x_{ij} + 
        β · Σᵢ max(0, Σⱼ x_{ij} - K_i)
```

Где:
- Первое слагаемое — общая стоимость доставки всех заказов
- Второе слагаемое — штраф за нарушение сроков доставки для приоритетных заказов
- Третье слагаемое — штраф за превышение пропускной способности складов

**Ограничения:**

1. **Каждый заказ должен быть назначен ровно одному складу:**
   ```
   Σᵢ x_{ij} = 1,  для всех j = 1, 2, ..., n
   ```

2. **Ограничение вместимости складов:**
   ```
   Q_i + Σⱼ V_j · x_{ij} ≤ C_i,  для всех i = 1, 2, ..., m
   ```

3. **Ограничение пропускной способности складов:**
   ```
   A_i + Σⱼ x_{ij} ≤ K_i,  для всех i = 1, 2, ..., m
   ```

4. **Ограничение на наличие товара на складе:**
   ```
   x_{ij} ≤ a_{ij},  для всех i, j
   ```
   где `a_{ij} = 1`, если товар заказа j есть на складе i, и `a_{ij} = 0` в противном случае

5. **Ограничение на срок доставки (мягкое ограничение, учитывается в целевой функции):**
   ```
   t_{ij} · x_{ij} ≤ T_j + M · (1 - x_{ij}),  для всех i, j
   ```
   где M — большое число (big-M метод)

6. **Бинарность переменных:**
   ```
   x_{ij} ∈ {0, 1},  для всех i, j
   ```

### 4.3. Упрощенная версия модели (линейная регрессия для прогноза)

Для прогнозирования стоимости и времени доставки можно использовать регрессионные модели:

**Модель стоимости доставки:**
```
c_{ij} = β₀ + β₁ · d_{ij} + β₂ · V_j + β₃ · W_j + β₄ · s_{ij} + ε_{ij}
```

где:
- `β₀` — базовая стоимость доставки
- `β₁` — коэффициент влияния расстояния
- `β₂` — коэффициент влияния объема
- `β₃` — коэффициент влияния веса
- `β₄` — коэффициент влияния способа доставки
- `ε_{ij}` — случайная ошибка

**Модель времени доставки:**
```
t_{ij} = γ₀ + γ₁ · d_{ij} + γ₂ · s_{ij} + γ₃ · region_j + ε'_{ij}
```

где:
- `γ₀` — базовое время доставки
- `γ₁` — коэффициент влияния расстояния на время
- `γ₂` — коэффициент влияния способа доставки
- `γ₃` — коэффициент влияния региона
- `ε'_{ij}` — случайная ошибка

### 4.4. Валидация модели

**Тестирование на исторических данных:**
- Разделение данных на обучающую (80%) и тестовую (20%) выборки
- Построение модели на обучающей выборке
- Проверка точности прогнозов на тестовой выборке
- Сравнение результатов оптимизации с фактическими решениями, принятыми ранее

**Метрики качества:**
- Средняя абсолютная ошибка (MAE) для стоимости и времени доставки
- Коэффициент детерминации R² для регрессионных моделей
- Процент заказов, для которых найдено оптимальное решение
- Сравнение общей стоимости доставки: фактическая vs оптимизированная

**Анализ сценариев:**
- Тестирование модели при различных уровнях спроса
- Проверка устойчивости решения при изменении параметров складов
- Анализ поведения модели при добавлении новых складов

**Пример валидации:**

Предположим, на исторических данных:
- Фактическая средняя стоимость доставки: 850 руб.
- Оптимизированная средняя стоимость доставки: 680 руб.
- Экономия: 20% (170 руб. на заказ)

При объеме 1000 заказов в день экономия составит 170,000 руб./день или ~5,100,000 руб./месяц.

---

## 5. Заключение

Представленная математическая модель позволяет:

1. **Оптимизировать распределение заказов** между складами с учетом множества факторов
2. **Минимизировать затраты** на доставку при соблюдении ограничений
3. **Учитывать временные ограничения** и приоритеты заказов
4. **Обеспечивать балансировку нагрузки** между складами

Модель является задачей целочисленного линейного программирования (ILP) и может быть решена с помощью специализированных решателей (например, CPLEX, Gurobi) или эвристических алгоритмов для больших размерностей.

Для практического применения рекомендуется:
- Регулярное обновление параметров модели на основе актуальных данных
- Интеграция с системами управления складом и заказами
- Постепенное внедрение с A/B тестированием результатов
- Мониторинг ключевых метрик для оценки эффективности модели

