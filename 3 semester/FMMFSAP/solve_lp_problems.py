"""
Решение практических заданий по линейному программированию
"""

import numpy as np
from scipy.optimize import linprog

print("=" * 70)
print("ПРАКТИЧЕСКИЕ ЗАДАНИЯ ПО ЛИНЕЙНОМУ ПРОГРАММИРОВАНИЮ")
print("=" * 70)

# ============================================================================
# ЗАДАЧА 1: ОПТИМИЗАЦИЯ ПРОИЗВОДСТВА
# ============================================================================

print("\n" + "=" * 70)
print("ЗАДАЧА 1: ОПТИМИЗАЦИЯ ПРОИЗВОДСТВА")
print("=" * 70)

# Коэффициенты целевой функции (для минимизации, поэтому меняем знак)
c = [-40, -60]  # Отрицательные, т.к. linprog минимизирует

# Матрица коэффициентов ограничений
A = [
    [3, 2],   # Ограничение по трудовым часам
    [2, 5]    # Ограничение по материалам
]

# Вектор правых частей ограничений
b = [120, 150]

# Границы переменных (неотрицательность)
x_bounds = [(0, None), (0, None)]

# Решение задачи
result = linprog(c, A_ub=A, b_ub=b, bounds=x_bounds, method='highs')

# Вывод результатов
print(f"\nСтатус решения: {result.message}")
print(f"\nОптимальное количество продукта A: {result.x[0]:.2f} единиц")
print(f"Оптимальное количество продукта B: {result.x[1]:.2f} единиц")
print(f"\nМаксимальная прибыль: {-result.fun:.2f} у.е.")
print(f"\nИспользование ресурсов:")
labor_used = 3*result.x[0] + 2*result.x[1]
material_used = 2*result.x[0] + 5*result.x[1]
print(f"  - Трудовые часы: {labor_used:.2f} из 120 ({labor_used/120*100:.1f}%)")
print(f"  - Материалы: {material_used:.2f} из 150 ({material_used/150*100:.1f}%)")

# ============================================================================
# ЗАДАЧА 2: ПРОБЛЕМА ДИЕТЫ
# ============================================================================

print("\n" + "=" * 70)
print("ЗАДАЧА 2: ПРОБЛЕМА ДИЕТЫ")
print("=" * 70)

# Коэффициенты целевой функции (минимизация стоимости)
c = [3, 5, 8]

# Матрица коэффициентов ограничений (неравенства >=)
# Преобразуем >= в <=, умножив на -1
A_ub = [
    [-5, -10, -15],   # Белки (>= 50)
    [-2, -5, -7],     # Жиры (>= 30)
    [-10, -20, -25]   # Углеводы (>= 100)
]

# Вектор правых частей ограничений (также умножаем на -1)
b_ub = [-50, -30, -100]

# Границы переменных (неотрицательность)
x_bounds = [(0, None), (0, None), (0, None)]

# Решение задачи
result = linprog(c, A_ub=A_ub, b_ub=b_ub, bounds=x_bounds, method='highs')

# Вывод результатов
print(f"\nСтатус решения: {result.message}")
print(f"\nОптимальное количество продукта 1: {result.x[0]:.2f} единиц")
print(f"Оптимальное количество продукта 2: {result.x[1]:.2f} единиц")
print(f"Оптимальное количество продукта 3: {result.x[2]:.2f} единиц")
print(f"\nМинимальная стоимость рациона: {result.fun:.2f} у.е.")
print(f"\nПотребление питательных веществ:")
protein = 5*result.x[0] + 10*result.x[1] + 15*result.x[2]
fat = 2*result.x[0] + 5*result.x[1] + 7*result.x[2]
carbs = 10*result.x[0] + 20*result.x[1] + 25*result.x[2]
print(f"  - Белки: {protein:.2f} г (требуется: 50 г, избыток: {protein-50:.2f} г)")
print(f"  - Жиры: {fat:.2f} г (требуется: 30 г, избыток: {fat-30:.2f} г)")
print(f"  - Углеводы: {carbs:.2f} г (требуется: 100 г, избыток: {carbs-100:.2f} г)")

# ============================================================================
# ЗАДАЧА 3: ТРАНСПОРТНАЯ ЗАДАЧА
# ============================================================================

print("\n" + "=" * 70)
print("ЗАДАЧА 3: ТРАНСПОРТНАЯ ЗАДАЧА")
print("=" * 70)

# Параметры задачи
supply = [100, 150, 200]  # Запасы на фабриках
demand = [80, 90, 110, 120, 50]  # Спрос в магазинах

# Матрица стоимости транспортировки
cost_matrix = [
    [4, 3, 6, 7, 9],  # Фабрика 1 -> Магазины 1-5
    [5, 4, 8, 6, 7],  # Фабрика 2 -> Магазины 1-5
    [9, 7, 4, 5, 6]   # Фабрика 3 -> Магазины 1-5
]

# Преобразование матрицы стоимости в вектор для целевой функции
c = [cost_matrix[i][j] for i in range(3) for j in range(5)]

# Построение матрицы ограничений
# Ограничения по запасам (3 ограничения)
A_supply = []
for i in range(3):
    row = [0] * 15
    for j in range(5):
        row[i * 5 + j] = 1
    A_supply.append(row)

# Ограничения по спросу (5 ограничений)
A_demand = []
for j in range(5):
    row = [0] * 15
    for i in range(3):
        row[i * 5 + j] = 1
    A_demand.append(row)

# Объединение ограничений
A_eq = A_supply + A_demand
b_eq = supply + demand

# Границы переменных (неотрицательность)
x_bounds = [(0, None)] * 15

# Решение задачи
result = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=x_bounds, method='highs')

# Преобразование результата обратно в матрицу
solution_matrix = result.x.reshape(3, 5)

# Вывод результатов
print(f"\nСтатус решения: {result.message}")
print(f"\nМинимальные затраты на транспортировку: {result.fun:.2f} у.е.")
print("\nОптимальный план перевозок:")
print("\n" + " " * 12 + "Магазин 1  Магазин 2  Магазин 3  Магазин 4  Магазин 5")
for i in range(3):
    print(f"Фабрика {i+1}:", end="")
    for j in range(5):
        print(f"  {solution_matrix[i][j]:8.2f}", end="")
    print(f"  (Всего: {sum(solution_matrix[i]):.2f})")

print("\n" + " " * 12 + "Магазин 1  Магазин 2  Магазин 3  Магазин 4  Магазин 5")
print("Получено:", end="")
for j in range(5):
    total = sum(solution_matrix[i][j] for i in range(3))
    print(f"  {total:8.2f}", end="")
print(f"\nТребуется:  {demand[0]:8.2f}  {demand[1]:8.2f}  {demand[2]:8.2f}  {demand[3]:8.2f}  {demand[4]:8.2f}")

# Проверка ограничений
print("\nПроверка ограничений:")
print("Запасы на фабриках:")
for i in range(3):
    total_sent = sum(solution_matrix[i])
    print(f"  Фабрика {i+1}: отправлено {total_sent:.2f}, запас {supply[i]} (разница: {abs(total_sent - supply[i]):.2f})")
print("\nСпрос в магазинах:")
for j in range(5):
    total_received = sum(solution_matrix[i][j] for i in range(3))
    print(f"  Магазин {j+1}: получено {total_received:.2f}, требуется {demand[j]} (разница: {abs(total_received - demand[j]):.2f})")

print("\n" + "=" * 70)
print("ВСЕ ЗАДАЧИ РЕШЕНЫ")
print("=" * 70)


