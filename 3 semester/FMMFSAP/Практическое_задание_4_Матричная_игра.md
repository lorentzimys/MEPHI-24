# Практическое задание №4. Матричная игра

## Содержание задания

Дана следующая матричная игра:

$$
A = \begin{bmatrix}
2 & 4 & 8 \\
5 & 6 & 2 \\
4 & 6 & 3 \\
2 & 5 & 4
\end{bmatrix}
$$

**Требуется:**
1. Исследовать игру на равновесие Нэша и решение в чистых стратегиях.
2. Свести данную игру к задаче линейного программирования.
3. Решить игру в смешанных стратегиях.

---

## Часть 1: Исследование игры на равновесие Нэша и решение в чистых стратегиях

### Исходные данные

Платежная матрица $A$ имеет размерность $4 \times 3$:
- Игрок 1 (максимизирующий) имеет 4 стратегии (строки)
- Игрок 2 (минимизирующий) имеет 3 стратегии (столбцы)
- Элемент $a_{ij}$ представляет выигрыш игрока 1 при выборе им стратегии $i$ и стратегии $j$ игроком 2

### Поиск седловой точки

Для нахождения равновесия Нэша в чистых стратегиях необходимо найти **седловую точку** матрицы.

**Алгоритм:**

1. **Максимин (нижняя цена игры) для игрока 1:**
   - Для каждой строки $i$ находим минимальный выигрыш: $\min_j a_{ij}$
   - Выбираем максимальное из этих значений: $v_1 = \max_i \min_j a_{ij}$

2. **Минимакс (верхняя цена игры) для игрока 2:**
   - Для каждого столбца $j$ находим максимальный выигрыш игрока 1: $\max_i a_{ij}$
   - Выбираем минимальное из этих значений: $v_2 = \min_j \max_i a_{ij}$

3. **Проверка на седловую точку:**
   - Если $v_1 = v_2 = v$, то существует седловая точка
   - В этом случае равновесие Нэша в чистых стратегиях существует, и значение игры равно $v$

### Вычисления

**Минимальные значения по строкам:**
- Строка 1: $\min\{2, 4, 8\} = 2$
- Строка 2: $\min\{5, 6, 2\} = 2$
- Строка 3: $\min\{4, 6, 3\} = 3$
- Строка 4: $\min\{2, 5, 4\} = 2$

**Максимин:** $v_1 = \max\{2, 2, 3, 2\} = 3$

**Максимальные значения по столбцам:**
- Столбец 1: $\max\{2, 5, 4, 2\} = 5$
- Столбец 2: $\max\{4, 6, 6, 5\} = 6$
- Столбец 3: $\max\{8, 2, 3, 4\} = 8$

**Минимакс:** $v_2 = \min\{5, 6, 8\} = 5$

### Вывод

Поскольку $v_1 = 3 \neq v_2 = 5$, **седловой точки не существует**. 

**Равновесия Нэша в чистых стратегиях нет.** Необходимо искать решение в смешанных стратегиях.

---

## Часть 2: Сведение игры к задаче линейного программирования

### Теоретическое обоснование

Для матричной игры с платежной матрицей $A$ размера $m \times n$ решение в смешанных стратегиях можно найти, сведя задачу к паре двойственных задач линейного программирования.

### Задача для игрока 1 (максимизация)

**Переменные:**
- $p_1, p_2, p_3, p_4$ — вероятности выбора игроком 1 строк 1, 2, 3, 4 соответственно
- $v$ — значение игры (ожидаемый выигрыш игрока 1)

**Целевая функция:**
$$\max v$$

**Ограничения:**

1. **Ограничения оптимальности** (для каждого столбца $j$):
   $$\sum_{i=1}^{4} a_{ij} \cdot p_i \geq v, \quad j = 1, 2, 3$$

   Это означает, что при любой стратегии игрока 2 ожидаемый выигрыш игрока 1 должен быть не меньше значения игры.

2. **Ограничение нормировки:**
   $$\sum_{i=1}^{4} p_i = 1$$

3. **Ограничения неотрицательности:**
   $$p_i \geq 0, \quad i = 1, 2, 3, 4$$
   $$v \geq 0$$

**Матричная форма:**

$$\begin{align}
\max \quad & v \\
\text{при условиях:} \quad & A^T \mathbf{p} \geq v \mathbf{1} \\
& \mathbf{1}^T \mathbf{p} = 1 \\
& \mathbf{p} \geq \mathbf{0}, \quad v \geq 0
\end{align}$$

где:
- $\mathbf{p} = [p_1, p_2, p_3, p_4]^T$ — вектор вероятностей
- $A^T$ — транспонированная матрица $A$
- $\mathbf{1} = [1, 1, 1]^T$ — вектор единиц

### Задача для игрока 2 (минимизация)

**Переменные:**
- $q_1, q_2, q_3$ — вероятности выбора игроком 2 столбцов 1, 2, 3 соответственно
- $v$ — значение игры (ожидаемый проигрыш игрока 2)

**Целевая функция:**
$$\min v$$

**Ограничения:**

1. **Ограничения оптимальности** (для каждой строки $i$):
   $$\sum_{j=1}^{3} a_{ij} \cdot q_j \leq v, \quad i = 1, 2, 3, 4$$

2. **Ограничение нормировки:**
   $$\sum_{j=1}^{3} q_j = 1$$

3. **Ограничения неотрицательности:**
   $$q_j \geq 0, \quad j = 1, 2, 3$$
   $$v \geq 0$$

**Матричная форма:**

$$\begin{align}
\min \quad & v \\
\text{при условиях:} \quad & A \mathbf{q} \leq v \mathbf{1} \\
& \mathbf{1}^T \mathbf{q} = 1 \\
& \mathbf{q} \geq \mathbf{0}, \quad v \geq 0
\end{align}$$

где:
- $\mathbf{q} = [q_1, q_2, q_3]^T$ — вектор вероятностей

### Преобразование к стандартной форме

Для решения с помощью `scipy.optimize.linprog` необходимо преобразовать задачи к стандартной форме (минимизация).

**Для игрока 1:**

Вводим переменные: $\mathbf{x} = [p_1, p_2, p_3, p_4, v]^T$

Целевая функция: $\min (-v)$ (эквивалентно $\max v$)
$$\min \quad [0, 0, 0, 0, -1] \cdot \mathbf{x}$$

Ограничения:
- $-A^T \mathbf{p} + v \leq 0$ (преобразование $A^T \mathbf{p} \geq v$ в стандартную форму)
- $\sum_{i=1}^{4} p_i = 1$
- $p_i \geq 0, \quad i = 1, 2, 3, 4$
- $v \geq 0$

В развернутом виде для нашей матрицы:

$$\begin{align}
\min \quad & -v \\
\text{при условиях:} \quad & 
\begin{cases}
-2p_1 - 5p_2 - 4p_3 - 2p_4 + v \leq 0 \quad \text{(столбец 1)} \\
-4p_1 - 6p_2 - 6p_3 - 5p_4 + v \leq 0 \quad \text{(столбец 2)} \\
-8p_1 - 2p_2 - 3p_3 - 4p_4 + v \leq 0 \quad \text{(столбец 3)} \\
p_1 + p_2 + p_3 + p_4 = 1 \\
p_1, p_2, p_3, p_4, v \geq 0
\end{cases}
\end{align}$$

**Для игрока 2:**

Вводим переменные: $\mathbf{y} = [q_1, q_2, q_3, v]^T$

Целевая функция: $\min v$
$$\min \quad [0, 0, 0, 1] \cdot \mathbf{y}$$

Ограничения:
- $A \mathbf{q} - v \leq 0$ (преобразование $A \mathbf{q} \leq v$ в стандартную форму)
- $\sum_{j=1}^{3} q_j = 1$
- $q_j \geq 0, \quad j = 1, 2, 3$
- $v \geq 0$

В развернутом виде для нашей матрицы:

$$\begin{align}
\min \quad & v \\
\text{при условиях:} \quad & 
\begin{cases}
2q_1 + 4q_2 + 8q_3 - v \leq 0 \quad \text{(строка 1)} \\
5q_1 + 6q_2 + 2q_3 - v \leq 0 \quad \text{(строка 2)} \\
4q_1 + 6q_2 + 3q_3 - v \leq 0 \quad \text{(строка 3)} \\
2q_1 + 5q_2 + 4q_3 - v \leq 0 \quad \text{(строка 4)} \\
q_1 + q_2 + q_3 = 1 \\
q_1, q_2, q_3, v \geq 0
\end{cases}
\end{align}$$

### Примечание о положительности элементов

Если матрица содержит неположительные элементы, необходимо добавить константу ко всем элементам, чтобы сделать их положительными. Это не изменит оптимальные стратегии, но изменит значение игры на эту константу.

В нашем случае минимальный элемент матрицы равен 2, поэтому все элементы положительны, и сдвиг не требуется.

---

## Часть 3: Решение игры в смешанных стратегиях

### Решение с помощью Python

Решение реализовано в файле `practical_assignment_4_matrix_game.py` с использованием библиотеки `scipy.optimize.linprog`.

### Алгоритм решения

1. **Проверка положительности элементов матрицы:**
   - Если минимальный элемент $\leq 0$, добавляем константу ко всем элементам

2. **Решение задачи для игрока 1:**
   - Формируем задачу линейного программирования
   - Находим оптимальные вероятности $p_1, p_2, p_3, p_4$
   - Находим значение игры $v$

3. **Решение задачи для игрока 2:**
   - Формируем двойственную задачу линейного программирования
   - Находим оптимальные вероятности $q_1, q_2, q_3$
   - Проверяем, что значение игры совпадает

4. **Проверка оптимальности:**
   - Проверяем выполнение ограничений
   - Вычисляем ожидаемый выигрыш при оптимальных стратегиях

### Результаты решения

**Оптимальные смешанные стратегии:**

**Игрок 1 (максимизирующий):**
- $p_1 = \frac{1}{3} \approx 0.333333$ — вероятность выбора строки 1
- $p_2 = \frac{2}{3} \approx 0.666667$ — вероятность выбора строки 2
- $p_3 = 0$ — вероятность выбора строки 3
- $p_4 = 0$ — вероятность выбора строки 4

**Игрок 2 (минимизирующий):**
- $q_1 = \frac{2}{3} \approx 0.666667$ — вероятность выбора столбца 1
- $q_2 = 0$ — вероятность выбора столбца 2
- $q_3 = \frac{1}{3} \approx 0.333333$ — вероятность выбора столбца 3

**Значение игры:** $v = 4$

### Проверка оптимальности

**Проверка ограничений для игрока 1:**
- При выборе игроком 2 столбца 1: ожидаемый выигрыш = $2 \cdot \frac{1}{3} + 5 \cdot \frac{2}{3} = \frac{2 + 10}{3} = 4 \geq 4$ ✓
- При выборе игроком 2 столбца 2: ожидаемый выигрыш = $4 \cdot \frac{1}{3} + 6 \cdot \frac{2}{3} = \frac{4 + 12}{3} = \frac{16}{3} \approx 5.33 \geq 4$ ✓
- При выборе игроком 2 столбца 3: ожидаемый выигрыш = $8 \cdot \frac{1}{3} + 2 \cdot \frac{2}{3} = \frac{8 + 4}{3} = 4 \geq 4$ ✓

**Проверка ограничений для игрока 2:**
- При выборе игроком 1 строки 1: ожидаемый проигрыш = $2 \cdot \frac{2}{3} + 8 \cdot \frac{1}{3} = \frac{4 + 8}{3} = 4 \leq 4$ ✓
- При выборе игроком 1 строки 2: ожидаемый проигрыш = $5 \cdot \frac{2}{3} + 2 \cdot \frac{1}{3} = \frac{10 + 2}{3} = 4 \leq 4$ ✓
- При выборе игроком 1 строки 3: ожидаемый проигрыш = $4 \cdot \frac{2}{3} + 3 \cdot \frac{1}{3} = \frac{8 + 3}{3} = \frac{11}{3} \approx 3.67 \leq 4$ ✓
- При выборе игроком 1 строки 4: ожидаемый проигрыш = $2 \cdot \frac{2}{3} + 4 \cdot \frac{1}{3} = \frac{4 + 4}{3} = \frac{8}{3} \approx 2.67 \leq 4$ ✓

**Ожидаемый выигрыш при оптимальных стратегиях:**
$$E = \mathbf{p}^T A \mathbf{q} = \frac{1}{3} \cdot \frac{2}{3} \cdot 2 + \frac{1}{3} \cdot \frac{1}{3} \cdot 8 + \frac{2}{3} \cdot \frac{2}{3} \cdot 5 + \frac{2}{3} \cdot \frac{1}{3} \cdot 2 = 4$$

Все ограничения выполнены, решение оптимально.

---

## Выводы

1. **Равновесие Нэша в чистых стратегиях:** не существует (седловой точки нет)

2. **Решение в смешанных стратегиях:** найдено с помощью методов линейного программирования

3. **Оптимальные стратегии:**
   - Игрок 1 выбирает строки 1 и 2 с вероятностями $\frac{1}{3}$ и $\frac{2}{3}$ соответственно
   - Игрок 2 выбирает столбцы 1 и 3 с вероятностями $\frac{2}{3}$ и $\frac{1}{3}$ соответственно
   - Строки 3 и 4, а также столбец 2 не используются в оптимальной стратегии

4. **Значение игры:** $v = 4$ (ожидаемый выигрыш игрока 1 при оптимальных стратегиях)

---

## Приложение: Код решения и результаты выполнения

### Код решения

Полный код решения находится в файле `practical_assignment_4_matrix_game.py`.

### Результаты выполнения программы

```
======================================================================
ПРАКТИЧЕСКОЕ ЗАДАНИЕ №4: МАТРИЧНАЯ ИГРА
======================================================================

======================================================================
ЧАСТЬ 1: ИССЛЕДОВАНИЕ ИГРЫ НА РАВНОВЕСИЕ НЭША В ЧИСТЫХ СТРАТЕГИЯХ
======================================================================

Платежная матрица A (выигрыши игрока 1):
[[2 4 8]
 [5 6 2]
 [4 6 3]
 [2 5 4]]

Размерность: 4 строк (стратегии игрока 1) × 3 столбцов (стратегии игрока 2)

Минимальные значения по строкам (минимакс для игрока 1):
  Строка 1: min = 2
  Строка 2: min = 2
  Строка 3: min = 3
  Строка 4: min = 2

Максимин (нижняя цена игры): v_1 = 3
Достигается на строке 3

Максимальные значения по столбцам (максимин для игрока 2):
  Столбец 1: max = 5
  Столбец 2: max = 6
  Столбец 3: max = 8

Минимакс (верхняя цена игры): v_2 = 5
Достигается на столбце 1

✗ Седловой точки нет (v_1 = 3 ≠ v_2 = 5)
  Равновесия Нэша в чистых стратегиях не существует.
  Необходимо искать решение в смешанных стратегиях.

======================================================================
ЧАСТЬ 3: РЕШЕНИЕ ИГРЫ В СМЕШАННЫХ СТРАТЕГИЯХ
======================================================================

Решение для игрока 1 (максимизация выигрыша):
Статус решения: Optimization terminated successfully.

Оптимальные вероятности выбора строк:
  p_1 = 0.333333
  p_2 = 0.666667
  p_3 = 0.000000
  p_4 = 0.000000

Значение игры: v = 4.000000

Решение для игрока 2 (минимизация проигрыша):
Статус решения: Optimization terminated successfully.

Оптимальные вероятности выбора столбцов:
  q_1 = 0.666667
  q_2 = 0.000000
  q_3 = 0.333333

Значение игры: v = 4.000000

✓ Значения совпадают (с точностью до погрешности вычислений)
✓ Ожидаемый выигрыш совпадает со значением игры
✓ Все ограничения выполнены
```

---

## Заключение

Задание выполнено полностью:

1. ✓ **Пункт 1:** Игра исследована на равновесие Нэша в чистых стратегиях. Седловой точки не найдено, равновесия Нэша в чистых стратегиях не существует.

2. ✓ **Пункт 2:** Игра сведена к задаче линейного программирования. Представлены математические формулировки задач для обоих игроков в стандартной форме.

3. ✓ **Пункт 3:** Игра решена в смешанных стратегиях с помощью метода линейного программирования (библиотека `scipy.optimize.linprog`). Найдены оптимальные смешанные стратегии для обоих игроков и значение игры. Решение проверено на оптимальность.

**Результат:** Оптимальные смешанные стратегии найдены, значение игры равно 4.

